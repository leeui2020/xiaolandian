(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41aa04e7"],{3057:function(e,t,r){"use strict";var i=r("90af"),a=r.n(i);a.a},"90af":function(e,t,r){},9345:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[r("el-row",{staticClass:"margin-bottom",attrs:{type:"flex",align:"middle",justify:"end"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addFormVisible=!0}}},[e._v("新增二维码")]),r("el-button",{attrs:{type:"danger",disabled:0===e.selection.length},on:{click:function(t){return e.removePaycode(e.selection)}}},[e._v("批量删除")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"margin-bottom",attrs:{data:e.list,stripe:"",border:""},on:{"selection-change":e.selectionChangeHandler}},[r("el-table-column",{attrs:{type:"selection",width:"55",fixed:"left"}}),r("el-table-column",{attrs:{prop:"qrcode",label:"二维码",width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return r("img",{staticClass:"qrcode",attrs:{src:e.row.qrcode.src}})}}])}),r("el-table-column",{attrs:{prop:"title",label:"描述","min-width":"160"}}),r("el-table-column",{attrs:{prop:"email",label:"通知邮箱","min-width":"160"}}),r("el-table-column",{attrs:{prop:"isClosed",label:"禁用","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return r("el-switch",{on:{change:function(r){return e.switchClosedHandler(t.row)}},model:{value:t.row.isClosed,callback:function(r){e.$set(t.row,"isClosed",r)},expression:"scope.row.isClosed"}})}}])}),r("el-table-column",{attrs:{prop:"createdAt",label:"创建时间","min-width":"180",formatter:e.dateFormatter}}),r("el-table-column",{attrs:{label:"操作",align:"center","min-width":"180",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return r("el-button-group",{},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.editPaycode(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(r){return e.removePaycode([t.row])}}},[e._v("删除")])],1)}}])})],1),r("el-pagination",{attrs:{total:e.total,"page-size":e.pagesize,"current-page":e.page,"current-change":e.getDataList}}),r("el-dialog",{attrs:{title:"新增二维码",visible:e.addFormVisible,"append-to-body":""},on:{"update:visible":function(t){e.addFormVisible=t},closed:e.addFormDialogClosed}},[r("el-form",{ref:"addFormRef",attrs:{"label-width":"80px","label-position":"left",model:e.addForm,rules:e.addFormRules}},[r("el-form-item",{attrs:{label:"二维码",prop:"qrcode"}},[r("el-button",{on:{click:function(t){return e.openMediaDialog("addForm")}}},[e._v("从媒体库选择")]),e.addForm.qrcode?r("span",{staticClass:"margin-left"},[e._v(e._s(e.addForm.qrcode.fileName))]):e._e()],1),r("el-form-item",{attrs:{label:"描述",prop:"title"}},[r("el-input",{model:{value:e.addForm.title,callback:function(t){e.$set(e.addForm,"title",t)},expression:"addForm.title"}})],1),r("el-form-item",{attrs:{label:"通知邮箱",prop:"email"}},[r("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:e.addFormLoading},on:{click:e.addFormSubmitHandler}},[e._v("保存")]),r("el-button",{on:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")])],1)],1),r("LeeMediaDialog",{ref:"media",on:{select:e.mediaSelectHandler}}),r("el-dialog",{attrs:{title:"编辑二维码",visible:e.editFormVisible,"append-to-body":""},on:{"update:visible":function(t){e.editFormVisible=t},closed:e.editFormDialogClosed}},[r("el-form",{ref:"editFormRef",attrs:{model:e.editForm,rules:e.addFormRules,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"二维码",prop:"qrcode"}},[r("el-button",{on:{click:function(t){return e.openMediaDialog("editForm")}}},[e._v("从媒体库选择")]),e.editForm.qrcode?r("span",{staticClass:"margin-left"},[e._v(e._s(e.editForm.qrcode.fileName))]):e._e()],1),r("el-form-item",{attrs:{label:"描述",prop:"title"}},[r("el-input",{model:{value:e.editForm.title,callback:function(t){e.$set(e.editForm,"title",t)},expression:"editForm.title"}})],1),r("el-form-item",{attrs:{label:"通知邮箱",prop:"email"}},[r("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:e.editFormLoading},on:{click:e.editFormSubmitHandler}},[e._v("保存")]),r("el-button",{on:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")])],1)],1)],1)},a=[],n=(r("d81d"),r("96cf"),r("1da1")),o=r("c1df"),l=r.n(o),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"媒体库",visible:e.visible,"append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},[e.visible?r("lee-media",{ref:"media",attrs:{multiple:!1}}):e._e(),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.confirmHandler}},[e._v("确定")]),r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)},d=[],c=r("89b1"),u={name:"LeeMediaDialog",components:{LeeMedia:c["default"]},data:function(){return{visible:!1}},methods:{confirmHandler:function(){var e=this.$refs.media;this.$emit("select",e.selection[0]||null),this.visible=!1},open:function(){this.visible=!0},close:function(){this.visible=!1}}},m=u,p=r("2877"),f=Object(p["a"])(m,s,d,!1,null,"e6320104",null),b=f.exports,g={name:"Paycode",components:{LeeMediaDialog:b},data:function(){return{page:1,pagesize:10,total:0,list:[],loading:!1,selection:[],addForm:{title:"",email:"",qrcode:null},addFormRules:{title:[{required:!0,message:"请填写描述"}],email:[{required:!0,message:"请填写通知邮箱"},{type:"email",message:"邮箱格式错误"}],qrcode:[{required:!0,message:"请选择二维码"}]},addFormLoading:!1,addFormVisible:!1,editForm:{title:"",email:"",qrcode:null},editFormLoading:!1,editFormVisible:!1,currentEdit:null}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDataList(1);case 2:case"end":return t.stop()}}),t)})))()},methods:{getDataList:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,t.$http.post("/paycode/list",{page:Math.max(1,e),pagesize:t.pagesize});case 3:i=r.sent,a=i.data,t.loading=!1,"ok"===a.status&&(t.page=a.data.page,t.pagesize=a.data.pagesize,t.total=a.data.total,t.list=a.data.list,t.selection=[]);case 7:case"end":return r.stop()}}),r)})))()},editPaycode:function(e){this.editForm.title=e.title,this.editForm.email=e.email,this.editForm.qrcode=e.qrcode,this.currentEdit=e,this.editFormVisible=!0},removePaycode:function(e){var t=this,r=e.map((function(e){return e._id}));0!==r.length&&this.$confirm("是否删除支付二维码？","删除提示",{type:"warning",callback:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(i){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("confirm"===i){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,e.next=5,t.$http.post("/paycode/remove",{_id:r});case 5:if(a=e.sent,n=a.data,t.loading=!1,"ok"===n.status){e.next=10;break}return e.abrupt("return",t.$message.error(n.errmsg));case 10:return t.$message.success("删除成功"),e.next=13,t.getDataList(t.list.length>1?t.page:t.page-1);case 13:case"end":return e.stop()}}),e)})));function i(t){return e.apply(this,arguments)}return i}()})},switchClosedHandler:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.post("/paycode/edit",{_id:e._id,modify:{isClosed:e.isClosed}});case 2:if(i=r.sent,a=i.data,"ok"===a.status){r.next=8;break}return e.isClosed=!e.isClosed,t.$message.error(a.errmsg),r.abrupt("return");case 8:t.$message.success("保存成功");case 9:case"end":return r.stop()}}),r)})))()},openMediaDialog:function(e){var t=this;this.$refs.media.open(),this._mediaSelectHandler=function(r){t[e].qrcode=r}},mediaSelectHandler:function(e){"function"===typeof this._mediaSelectHandler&&this._mediaSelectHandler.call(this,e)},addFormDialogClosed:function(){this.$refs.addFormRef.resetFields(),delete this._mediaSelectHandler},editFormDialogClosed:function(){this.currentEdit=null,this.$refs.editFormRef.resetFields(),delete this._mediaSelectHandler},addFormSubmitHandler:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,i,a,n,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.addFormLoading){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$refs.addFormRef.validate();case 4:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:return e.addFormLoading=!0,r=e.addForm,i=r.title,a=r.email,n=r.qrcode,t.next=10,e.$http.post("/paycode/add",{title:i,email:a,qrcode:n._id});case 10:if(o=t.sent,l=o.data,e.addFormLoading=!1,"ok"===l.status){t.next=15;break}return t.abrupt("return",e.$message.error(l.errmsg));case 15:return e.$message.success("新增成功"),e.addFormVisible=!1,t.next=19,e.getDataList(1);case 19:case"end":return t.stop()}}),t)})))()},editFormSubmitHandler:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,i,a,n,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.editFormLoading){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$refs.editFormRef.validate();case 4:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:return e.editFormLoading=!0,r=e.editForm,i=r.title,a=r.email,n=r.qrcode,t.next=10,e.$http.post("/paycode/edit",{_id:e.currentEdit._id,modify:{title:i,email:a,qrcode:n._id}});case 10:if(o=t.sent,l=o.data,e.editFormLoading=!1,"ok"===l.status){t.next=15;break}return t.abrupt("return",e.$message.error(l.errmsg));case 15:return e.editFormVisible=!1,e.$message.success("保存成功"),t.next=19,e.getDataList(e.page);case 19:case"end":return t.stop()}}),t)})))()},dateFormatter:function(e,t,r){return l()(r).format("YYYY/MM/DD")},selectionChangeHandler:function(e){this.selection=e}}},h=g,v=(r("3057"),Object(p["a"])(h,i,a,!1,null,"6101b9eb",null));t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-41aa04e7.049bbb3c.js.map