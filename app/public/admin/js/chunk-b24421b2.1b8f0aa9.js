(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b24421b2"],{b0c0:function(e,t,i){var a=i("83ab"),r=i("9bf2").f,n=Function.prototype,o=n.toString,l=/^\s*function ([^ (]*)/,s="name";a&&!(s in n)&&r(n,s,{configurable:!0,get:function(){try{return o.call(this).match(l)[1]}catch(e){return""}}})},d2f1:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",{staticClass:"margin-bottom",attrs:{type:"flex",align:"middle",justify:"end"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("添加产品")]),i("el-button",{attrs:{type:"danger",disabled:0===e.selection.length},on:{click:function(t){return e.removeProducts(e.selection)}}},[e._v("批量删除")])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"margin-bottom",attrs:{data:e.list,stripe:"",border:""},on:{"selection-change":e.selectionChangeHandler}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center",fixed:"left"}}),i("el-table-column",{attrs:{label:"缩略图",width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return i("div",{staticClass:"thumbnail"},[i("img",{attrs:{src:e.row.thumbnail.src}})])}}])}),i("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"160"}}),i("el-table-column",{attrs:{prop:"price",label:"价格",width:"160",align:"center",formatter:e.priceFormatter}}),i("el-table-column",{attrs:{prop:"createdAt",label:"添加时间",width:"160",align:"center",formatter:e.dateFormatter}}),i("el-table-column",{attrs:{label:"操作",align:"center","min-width":"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.openEditDialog(t.row)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return e.removeProducts([t.row])}}},[e._v("删除")])]}}])})],1),i("el-pagination",{attrs:{"page-size":e.pagesize,"current-page":e.page,total:e.total},on:{"current-change":e.getProductList}}),i("el-dialog",{attrs:{title:"媒体库",visible:e.mediaDialgVisible,"append-to-body":""},on:{"update:visible":function(t){e.mediaDialgVisible=t}}},[e.mediaDialgVisible?i("lee-media",{ref:"media",attrs:{multiple:!1}}):e._e(),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.mediaDialogConfirm}},[e._v("确定")]),i("el-button",{on:{click:function(t){e.mediaDialgVisible=!1}}},[e._v("取消")])],1)],1),i("el-dialog",{attrs:{title:"添加产品",visible:e.addDialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.addDialogVisible=t},closed:e.addDialogCloseHandler}},[i("el-form",{ref:"addDialogForm",attrs:{"label-width":"80px","label-position":"left",model:e.addDialogForm,rules:e.addDialogRules}},[i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{model:{value:e.addDialogForm.name,callback:function(t){e.$set(e.addDialogForm,"name",t)},expression:"addDialogForm.name"}})],1),i("el-form-item",{attrs:{label:"缩略图",prop:"thumbnail"}},[i("el-button",{on:{click:function(t){e.mediaDialgVisible=!0}}},[e._v("从媒体库选择")]),e.currentSelectMedia?i("span",{staticClass:"margin-left"},[e._v("已选择")]):e._e()],1),i("el-form-item",{attrs:{label:"价格",prop:"price"}},[i("el-input",{model:{value:e.addDialogForm.price,callback:function(t){e.$set(e.addDialogForm,"price",e._n(t))},expression:"addDialogForm.price"}},[i("span",{attrs:{slot:"append"},slot:"append"},[e._v("元")])])],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.addDialogLoading},on:{click:e.addDialogConfirm}},[e._v("确定")]),i("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取消")])],1)],1),i("el-dialog",{attrs:{title:"编辑产品",visible:e.editDialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.editDialogVisible=t},closed:e.editDialogCloseHandler}},[i("el-form",{ref:"editDialogForm",attrs:{"label-width":"80px","label-position":"left",model:e.editDialogForm,rules:e.editDialogRules}},[i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{model:{value:e.editDialogForm.name,callback:function(t){e.$set(e.editDialogForm,"name",t)},expression:"editDialogForm.name"}})],1),i("el-form-item",{attrs:{label:"缩略图",prop:"thumbnail"}},[i("el-button",{on:{click:function(t){e.mediaDialgVisible=!0}}},[e._v("从媒体库选择")]),e.currentSelectMedia?i("span",{staticClass:"margin-left"},[e._v("已选择")]):e._e()],1),i("el-form-item",{attrs:{label:"价格",prop:"price"}},[i("el-input",{model:{value:e.editDialogForm.price,callback:function(t){e.$set(e.editDialogForm,"price",e._n(t))},expression:"editDialogForm.price"}},[i("span",{attrs:{slot:"append"},slot:"append"},[e._v("元")])])],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.editDialogLoading},on:{click:e.editDialogConfirm}},[e._v("保存")]),i("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取消")])],1)],1)],1)},r=[],n=(i("d81d"),i("fb6a"),i("b0c0"),i("96cf"),i("1da1")),o=i("c1df"),l=i.n(o),s=i("89b1"),d={name:"Product",components:{LeeMedia:s["default"]},data:function(){return{page:1,pagesize:10,total:0,list:[],loading:!1,selection:[],currentSelectMedia:null,mediaDialgVisible:!1,addDialogVisible:!1,addDialogForm:{name:"",price:0},addDialogRules:{name:[{required:!0,message:"请填写产品名称"}],price:[{required:!0,message:"请填写产品价格"}]},addDialogLoading:!1,editDialogVisible:!1,editDialogForm:{name:"",price:0},editDialogRules:{name:[{required:!0,message:"请填写产品名称"}],price:[{required:!0,message:"请填写产品价格"}]},editDialogLoading:!1,editProductId:null}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getProductList(1);case 2:case"end":return t.stop()}}),t)})))()},methods:{mediaDialogConfirm:function(){var e=this.$refs.media;this.currentSelectMedia=e.selection[0]||null,this.mediaDialgVisible=!1},addDialogConfirm:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,a,r,n,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.addDialogLoading){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$refs.addDialogForm.validate();case 4:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:return e.addDialogLoading=!0,i=e.addDialogForm,a=i.name,r=i.price,n=e.currentSelectMedia,t.next=11,e.$http.post("/product/add",{name:a,price:Math.ceil(100*r),thumbnail:n&&n._id});case 11:if(o=t.sent,l=o.data,e.addDialogLoading=!1,"ok"===l.status){t.next=16;break}return t.abrupt("return",e.$message.error(l.errmsg));case 16:return e.$message.success("添加成功"),e.addDialogVisible=!1,t.next=20,e.getProductList(1);case 20:case"end":return t.stop()}}),t)})))()},getProductList:function(){var e=arguments,t=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var a,r,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:1,t.loading=!0,i.next=4,t.$http.post("/product/list",{page:Math.max(1,a),pagesize:t.pagesize});case 4:r=i.sent,n=r.data,t.loading=!1,"ok"===n.status&&(t.page=n.data.page,t.pagesize=n.data.pagesize,t.list=n.data.list.slice(0),t.total=n.data.total,t.selection=[]);case 8:case"end":return i.stop()}}),i)})))()},priceFormatter:function(e){return"￥".concat(e.price/100)},dateFormatter:function(e){return l()(e.createdAt).format("YYYY/MM/DD")},selectionChangeHandler:function(e){this.selection=e},removeProducts:function(e){var t=this,i=e.map((function(e){return e._id}));0!==i.length&&this.$confirm("是否删除选中的产品？","删除确认",{type:"warning",callback:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(a){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("confirm"===a){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,e.next=5,t.$http.post("/product/remove",{products:i});case 5:if(r=e.sent,n=r.data,t.loading=!1,"ok"===n.status){e.next=10;break}return e.abrupt("return",t.$message.error(n.errmsg));case 10:return t.$message.success("删除成功"),e.next=13,t.getProductList(1===t.list.length?t.page-1:t.page);case 13:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()})},editDialogConfirm:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,a,r,n,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.editProductId){t.next=2;break}return t.abrupt("return");case 2:if(!e.editDialogLoading){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$refs.editDialogForm.validate();case 6:if(t.sent){t.next=8;break}return t.abrupt("return");case 8:return e.editDialogLoading=!0,i=e.editDialogForm,a=i.name,r=i.price,n=e.currentSelectMedia,t.next=13,e.$http.post("/product/update",{_id:e.editProductId,modify:{name:a,price:Math.ceil(100*r),thumbnail:n&&n._id}});case 13:if(o=t.sent,l=o.data,e.editDialogLoading=!1,"ok"===l.status){t.next=18;break}return t.abrupt("return",e.$message.error(l.errmsg));case 18:return e.$message.success("更新成功"),e.editDialogVisible=!1,t.next=22,e.getProductList(e.page);case 22:case"end":return t.stop()}}),t)})))()},openEditDialog:function(e){this.editDialogForm.name=e.name,this.editDialogForm.price=e.price/100,this.currentSelectMedia=e.thumbnail,this.editProductId=e._id,this.editDialogVisible=!0},addDialogCloseHandler:function(){this.currentSelectMedia=null,this.$refs.addDialogForm.resetFields()},editDialogCloseHandler:function(){this.editProductId=null,this.currentSelectMedia=null,this.$refs.editDialogForm.resetFields()}}},c=d,u=i("2877"),g=Object(u["a"])(c,a,r,!1,null,"3b4708df",null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-b24421b2.1b8f0aa9.js.map